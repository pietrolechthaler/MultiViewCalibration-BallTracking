<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Computer Vision Project</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>Computer Vision Project</h1>
    <p>Click on the volleyball court to view the corresponding point on the cameras</p>

    <div class="image-row">
        <div class="static-image-container" style="position: relative; display: inline-block;">
            <img id="courtImage" src="{{ url_for('static', filename='court.jpg') }}" alt="Court Image" style="width: 500px; height: auto;">
        </div>

        <div class="image-container" id="imageContainer"></div>
    </div>

    <script>
        const courtImage = document.getElementById('courtImage');
        const imageContainer = document.getElementById('imageContainer');

        // Load images initially
        fetch('/images')
            .then(response => response.json())
            .then(images => {
                images.forEach(image => {
                    const imgContainer = document.createElement('div');
                    imgContainer.style.position = 'relative';

                    const img = document.createElement('img');
                    img.src = image.src;
                    img.dataset.index = image.label;
                    img.id = image.label;

                    const label = document.createElement('p');
                    label.textContent = image.label;

                    imgContainer.appendChild(img);
                    imgContainer.appendChild(label);
                    imageContainer.appendChild(imgContainer);
                });
            });
        
        // Add click event listener to the court image
        courtImage.addEventListener('click', (event) => {
            const rect = courtImage.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;

            fetch('/click', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ x: x, y: y})
            })
            .then(response => response.json())
            .then(data => {
                displayCorrespondingPoints(data.points);
            });
        });

        // Function to display corresponding points on the images
        function displayCorrespondingPoints(points) {
            document.querySelectorAll('.point-marker').forEach(marker => marker.remove());

            Object.entries(points).forEach(([label, coords]) => {
                const img = document.querySelector(`img[data-index="${label}"]`);
                if (img) {
                    const rect = img.getBoundingClientRect();
                    const imgContainer = img.parentElement;

                    const pointMarker = document.createElement('div');
                    pointMarker.className = 'point-marker';
                    pointMarker.style.left = `${coords.x}px`;
                    pointMarker.style.top = `${coords.y}px`;

                    imgContainer.appendChild(pointMarker);
                }
            });
        }
    </script>
</body>
</html>
